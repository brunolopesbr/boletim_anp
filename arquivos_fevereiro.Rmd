---
title: "importar_fevereiro"
author: "BML"
date: "2024-08-02"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
```{r}
library(tidyverse)
```

```{r}
read_tab <- function(x) {read_delim(x, 
    delim = "\t", escape_double = FALSE, 
    locale = locale(decimal_mark = ",", grouping_mark = "."), 
    trim_ws = TRUE)}
```


# Preparar arquivos

```{r}
arquivos_fev_2024 <- list.files(path = "fevereiro", pattern = "tsv")
arquivos_fev_2024 <- paste0("fevereiro/", arquivos_fev_2024)
```
 Criar lista com arquivos de fevereiro de 2024
```{r}
lista_fev_2024 <- map(arquivos_fev_2024, read_tab)  
```

```{r}
length(lista_fev_2024)

```


## Limpando arquivos

### Data do boletim

Ao importar cada planilha do boletim é inserida a sua data em cada linha de cada tabela, dentro de uma coluna com o nome "mes". Isso também será feito com todos os dataframes do mês de fevereiro ("2024-01-01").

```{r}
# mutate(mes = mes_boletim)

boletim_fev <- as.Date("2024-01-01")
boletim_fev
```
```{r}
lista_fev_2024[[5]] |> 
  mutate(mes = boletim_fev)
```
```{r}
i <- 1

for(i in seq_along(lista_fev_2024)){
lista_fev_2024[[i]] <- lista_fev_2024[[i]] |> 
  mutate(mes = as.Date(boletim_fev))

i <- 1 + 1  
}

```

## Apagar coluna "Nº"



### Tabelas 1, 2, 3 e 4 (histórico)
A cada mês o conteúdo dos dataframes numerados de 1 a 4 é acrescido de apenas uma linha. Logo, o conteúdo publicado em fevereiro foi divulgado em março. Portanto, não é preciso importar esse conteúdo à base de dados.



## Importar base atual

```{r}
arquivos_base_atual <- list.files(path = "csv", pattern = ".csv")
arquivos_base_atual <- paste0("csv/", arquivos_base_atual)
```
 Criar lista com arquivos de fevereiro de 2024
```{r}
base_atual <- map(arquivos_base_atual, read_csv)  
```


## Incorporar conteúdo de fevereiro à base de dados atuais

Os nomes de fevereiro estão na mesma ordem da base atual, mas não exatamente iguais. Então, copiamos os nomes da base atual para a lista com as tabelas de fevereiro.



```{r}
bind_rows(base_atual[[5]],lista_fev_2024[[5]])


```



length(lista_fev_2024)
Em seguida são incorporados os dataframes de 5 em diante à base atual:
```{r}
i <- 5
for(i in 6:length(base_atual)){
  base_atual[[i]] <- bind_rows(base_atual[[i]],lista_fev_2024[[i]])  
  
  i <- i + 1
}
```


```{r}
base_atual
```

